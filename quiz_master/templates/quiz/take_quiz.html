{% extends "base.html" %} {% block title %}{{ quiz.title }} - Quiz Master{%
endblock %} {% block content %}
<div class="card mt-3">
  <div class="mb-3">
    <h1 class="text-2xl font-bold">{{ quiz.title }}</h1>
    <p class="text-secondary mt-1">{{ quiz.description }}</p>
  </div>

  <div class="mb-3">
    <div class="flex justify-between items-center">
      <span class="text-secondary">Time Remaining:</span>
      <span id="timer" class="text-xl font-bold text-primary"
        >{{ quiz.time_limit }}:00</span
      >
    </div>
    <div class="bg-secondary h-2 rounded-full mt-2">
      <div
        id="progress-bar"
        class="bg-primary h-2 rounded-full"
        style="width: 100%"
      ></div>
    </div>
  </div>

  <form method="POST" id="quiz-form">
    {% for question in questions %}
    <div class="card mb-3" id="question-{{ loop.index }}">
      <h3 class="text-xl mb-2">Question {{ loop.index }}</h3>
      <p class="mb-3">{{ question.text }}</p>

      {% if question.image_url %}
      <img
        src="{{ question.image_url }}"
        alt="Question image"
        class="mb-3 rounded-lg max-w-full h-auto"
      />
      {% endif %}

      <div class="space-y-2">
        {% for option in question.options %}
        <label
          class="flex items-center p-3 border rounded-lg hover:bg-secondary cursor-pointer transition-colors"
        >
          <input
            type="radio"
            name="question_{{ question.id }}"
            value="{{ option.id }}"
            class="mr-3"
          />
          <span>{{ option.text }}</span>
        </label>
        {% endfor %}
      </div>
    </div>
    {% endfor %}

    <div class="flex justify-between items-center mt-3">
      <button
        type="button"
        id="prev-btn"
        class="btn btn-secondary"
        onclick="previousQuestion()"
      >
        Previous
      </button>
      <div class="flex gap-2">
        {% for i in range(questions|length) %}
        <button
          type="button"
          class="question-dot w-3 h-3 rounded-full bg-secondary"
          data-question="{{ i + 1 }}"
        ></button>
        {% endfor %}
      </div>
      <button
        type="button"
        id="next-btn"
        class="btn btn-primary"
        onclick="nextQuestion()"
      >
        Next
      </button>
    </div>

    <div class="text-center mt-3">
      <button type="submit" class="btn btn-primary">Submit Quiz</button>
    </div>
  </form>
</div>

<script>
  let currentQuestion = 1;
  const totalQuestions = {{ questions|length }};
  const timeLimit = {{ quiz.time_limit }} * 60; // Convert to seconds
  let timeRemaining = timeLimit;

  function updateTimer() {
      const minutes = Math.floor(timeRemaining / 60);
      const seconds = timeRemaining % 60;
      document.getElementById('timer').textContent =
          `${minutes}:${seconds.toString().padStart(2, '0')}`;

      const progressPercent = (timeRemaining / timeLimit) * 100;
      document.getElementById('progress-bar').style.width = `${progressPercent}%`;

      if (timeRemaining <= 0) {
          document.getElementById('quiz-form').submit();
      }
      timeRemaining--;
  }

  function showQuestion(questionNumber) {
      // Hide all questions
      document.querySelectorAll('[id^="question-"]').forEach(q => {
          q.style.display = 'none';
      });

      // Show current question
      document.getElementById(`question-${questionNumber}`).style.display = 'block';

      // Update navigation buttons
      document.getElementById('prev-btn').disabled = questionNumber === 1;
      document.getElementById('next-btn').textContent =
          questionNumber === totalQuestions ? 'Review' : 'Next';

      // Update question dots
      document.querySelectorAll('.question-dot').forEach((dot, index) => {
          dot.classList.toggle('bg-primary', index + 1 === questionNumber);
          dot.classList.toggle('bg-secondary', index + 1 !== questionNumber);
      });

      currentQuestion = questionNumber;
  }

  function nextQuestion() {
      if (currentQuestion < totalQuestions) {
          showQuestion(currentQuestion + 1);
      }
  }

  function previousQuestion() {
      if (currentQuestion > 1) {
          showQuestion(currentQuestion - 1);
      }
  }

  // Initialize
  showQuestion(1);
  setInterval(updateTimer, 1000);

  // Add click handlers to question dots
  document.querySelectorAll('.question-dot').forEach(dot => {
      dot.addEventListener('click', () => {
          showQuestion(parseInt(dot.dataset.question));
      });
  });
</script>
{% endblock %}
